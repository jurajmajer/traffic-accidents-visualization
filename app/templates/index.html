<html>
    <head>
        <title>Traffic accidents</title>
		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    	<script>
        
            $(document).ready(function(){
                $( "#s" ).change(function() {
                  refreshAll()
                });
                $( "#e" ).change(function() {
                  refreshAll()
                });
            });
            
            function refreshAll()
            {
                refresh("/api/figure/total_accidents_by_days", "plot1")
                refresh("/api/figure/avg_accidents_by_weekdays", "plot2")
                refresh("/api/figure/total_accidents_by_county", "plot3")
                refresh("/api/figure/total_accidents_by_district", "plot4")
                refresh("/api/figure/accident_by_time_in_day", "plot5")
            }
            
            function refresh(url, plotId) {
                req = $.ajax({
                    url : url,
                    type : "GET",
                    data: {s: $("#s").val(), e: $("#e").val()}
                });
        
                req.done(function(data) {
                    $("#"+plotId).fadeOut(100).fadeIn(300);
                    Plotly.react(plotId, data, {});     
                });
            }
    	
    	</script>
    </head>
    <body>
        <form id="form1" action="#">
          <label for="s">Date from:</label>
          <input type="date" id="s" name="s" value="{{ start_date }}" />
          <label style="margin-left:30px;" for="e">Date to:</label>
          <input type="date" id="e" name="e" value="{{ end_date }}" /><br/>
        </form>
        
        <div id="plot1">
            <script>
              var graphs = {{plot1}};
              Plotly.plot('plot1', graphs, {});
            </script>
        </div>
        
        <div id="plot2">
            <script>
              var graphs = {{plot2}};
              Plotly.plot('plot2', graphs, {});
            </script>
        </div>
        
        <div id="plot3">
            <script>
              var graphs = {{plot3}};
              Plotly.plot('plot3', graphs, {});
            </script>
        </div>
        
        <div id="plot4">
            <script>
              var graphs = {{plot4}};
              Plotly.plot('plot4', graphs, {});
            </script>
        </div>
        
        <div id="plot5">
            <script>
              var graphs = {{plot5}};
              Plotly.plot('plot5', graphs, {});
            </script>
        </div>

    </body>
</html>