{% extends "base.html" %}

{% block head %}
	<script>
        
		function refreshAll()
		{
			refresh("/api/map/choropleth_district", "choropleth_map")
			refresh("/api/figure/total_accidents_by_district", "total_accidents_by_district_plot")
		}
		
		$(function() {
		
			var choroplethDiv = document.getElementById('choropleth_map')
			choroplethDiv.on('plotly_click', function(data){
				if(data.points.length > 0)
				{
					var url = "/district_detail/" + data.points[0].properties.IDN3
					window.location.href = url
				}
			});
			
			var plotDiv = document.getElementById('plot1')
			plotDiv.on('plotly_click', function(data){
				if(data.points.length > 0)
				{
					var url = "/district_detail/" + data.points[0].customdata[0]
					window.location.href = url
				}
			});
		});
	
	</script>
{% endblock %}

{% block content %}
    <h2 class="w3-panel" style="margin-top:45px;">Celkový počet nehôd podľa okresu (<span id="choropleth_map-start-date-label">{{start_date.strftime("%d %b %Y")}}</span> - <span id="choropleth_map-end-date-label">{{end_date.strftime("%d %b %Y")}}</span>)</h2>
    <div id="choropleth_map" style="height:600px;" class="figure-general">
		<script>
		  var data = {{choropleth_map}};
		  Plotly.plot('choropleth_map', data, {});
		</script>
	</div>
	
	<h2 class="w3-panel" style="margin-top:45px;">Absolútny počet nehôd podľa okresu (<span id="total_accidents_by_district_plot-start-date-label">{{start_date.strftime("%d %b %Y")}}</span> - <span id="total_accidents_by_district_plot-end-date-label">{{end_date.strftime("%d %b %Y")}}</span>)</h2>
	<div id="total_accidents_by_district_plot" class="figure-general">
		<script>
		  var graphs = {{total_accidents_by_district_plot}};
		  Plotly.plot('total_accidents_by_district_plot', graphs, {});
		</script>
	</div>
{% endblock %}